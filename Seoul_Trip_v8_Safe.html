<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seoul Trip v8 Safe</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Map CSS (Loaded but passive) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

    <style>
        :root {
            --primary: #1877F2;
            --bg: #F0F2F5;
            --white: #FFFFFF;
            --text: #050505;
            --text-sec: #65676B;
            --food: #ff6b6b;
            --cafe: #48dbfb;
            --shop: #a29bfe;
            --work: #57606f;
            --accom: #1dd1a1;
            --attr: #ff9f43;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Noto Sans TC', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; }
        
        /* Header */
        .app-header {
            background: rgba(255,255,255,0.98);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .app-title { font-size: 1.2rem; font-weight: 800; display: flex; align-items: center; gap: 8px; }
        .map-toggle-btn {
            background: #eee;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .map-toggle-btn.active { background: var(--primary); color: white; }

        /* Sticky Tabs */
        .tabs-container {
            position: sticky;
            top: 71px; 
            z-index: 900;
            background: var(--bg);
            padding: 10px 0;
            overflow-x: auto;
            white-space: nowrap;
            -ms-overflow-style: none;
            scrollbar-width: none;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        
        .tab-btn {
            display: inline-block;
            margin-left: 12px;
            padding: 8px 16px;
            background: var(--white);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-sec);
            border: 1px solid #ddd;
            cursor: pointer;
            transition: 0.2s;
        }
        .tab-btn:last-child { margin-right: 12px; }
        .tab-btn.active {
            background: var(--text);
            color: white;
            border-color: var(--text);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* Container */
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 10px 15px; 
            min-height: 300px;
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.03);
        }
        
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .card-badges { display: flex; gap: 6px; flex-wrap: wrap; }
        .badge { font-size: 0.75rem; padding: 3px 8px; border-radius: 6px; color: white; font-weight: 600; }
        .badge.zone { background: #eee; color: #555; }
        
        /* Category Colors */
        .cat-ÁæéÈ£ü { background: var(--food); }
        .cat-Êó©ÂçàÈ§ê { background: #feca57; color: #333; }
        .cat-ÂíñÂï°ÁîúÈªû { background: var(--cafe); color: #333; }
        .cat-Ë≥ºÁâ©, .cat-ÈÅ∏Áâ©, .cat-ÊúçÈ£æ, .cat-ÂΩ©Â¶ù, .cat-ÈõúË≤® { background: var(--shop); }
        .cat-Work, .cat-Â±ïË¶Ω { background: var(--work); }
        .cat-‰ΩèÂÆø { background: var(--accom); }
        .cat-ÊôØÈªû { background: var(--attr); }

        .place-name-cn { font-size: 1.15rem; font-weight: 700; color: #111; margin-bottom: 4px; line-height: 1.3; }
        .place-name-kr { font-size: 0.9rem; color: #777; font-weight: 500; margin-bottom: 10px; font-family: "Malgun Gothic", sans-serif; }
        
        .info-row { display: flex; align-items: flex-start; gap: 6px; font-size: 0.85rem; color: #555; margin-bottom: 4px; }
        
        .actions { margin-top: 15px; display: flex; gap: 10px; }
        .action-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .btn-google { background: #e8f0fe; color: #1967d2; }
        .btn-naver { background: #e0f8eb; color: #03c75a; }

        /* Map View */
        #map-container {
            position: fixed;
            top: 72px; 
            left: 0;
            width: 100%;
            height: calc(100% - 72px);
            background: white;
            z-index: 950;
            display: none; 
        }
        #map-container.visible { display: block; }
        #map { width: 100%; height: 100%; }
        
        /* Map Popup */
        .leaflet-popup-content-wrapper { border-radius: 12px; }
        .popup-title { font-weight: bold; font-size: 1rem; margin-bottom: 5px; }
        .popup-nav { display: block; margin-top: 8px; background: #03C75A; color: white; text-align: center; padding: 6px; border-radius: 6px; text-decoration: none; font-size: 0.8rem; }
        
        #error-msg { color: red; padding: 20px; text-align: center; display: none; }
    </style>
</head>
<body>

    <div class="app-header">
        <div class="app-title">üá∞üá∑ Seoul Trip v8</div>
        <button class="map-toggle-btn" id="map-btn" onclick="toggleMode()">üó∫Ô∏è</button>
    </div>

    <div class="tabs-container" id="category-tabs">
        <div class="tab-btn active" onclick="filter('all')">ÂÖ®ÈÉ®</div>
        <div class="tab-btn" onclick="filter('ÁæéÈ£ü')">ÁæéÈ£ü</div>
        <div class="tab-btn" onclick="filter('ÂíñÂï°ÁîúÈªû')">ÂíñÂï°/ÁîúÈªû</div>
        <div class="tab-btn" onclick="filter('Ë≥ºÁâ©')">Ë≥ºÁâ©/ÈÄõË°ó</div>
        <div class="tab-btn" onclick="filter('Work')">Work</div>
        <div class="tab-btn" onclick="filter('‰ΩèÂÆø')">‰ΩèÂÆø</div>
        <div class="tab-btn" onclick="filter('ÊôØÈªû')">ÊôØÈªû</div>
    </div>

    <!-- Map View -->
    <div id="map-container">
        <div id="map"></div>
    </div>

    <!-- List View -->
    <div class="container" id="list-container">
        <div id="loading-msg" style="text-align:center; padding:40px; color:#888;">Loading lists... ‚è≥</div>
        <div id="error-msg"></div>
    </div>

    <!-- CRITICAL: Main Logic Script immediately after HTML content -->
    <script>
        // 1. Define Data Synchronously
        const places = [
            {"cn_name":"ÈùíÁì¶Â±ã (Cheongwaok)","kr_name":"Ï≤≠ÏôÄÏò• ÏùÑÏßÄÎ°ú3Í∞ÄÏßÅÏòÅÏ†ê","category":"ÁæéÈ£ü","note":"ÂäâÂú®Áü≥Êé®Ëñ¶ÊπØÈ£Ø","hours":"08:00 - 22:00","address":"ÏÑúÏö∏ Ï§ëÍµ¨ ÏùÑÏßÄÎ°ú 110","lat":37.5660015,"lon":126.9901968,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"ÂÄ´Êï¶Ë≤ùÊûúÂçöÁâ©È§® (London Bagel Museum)","kr_name":"Îü∞ÎçòÎ≤†Ïù¥Í∏ÄÎÆ§ÏßÄÏóÑ ÏïàÍµ≠Ï†ê","category":"Êó©ÂçàÈ§ê","note":"Êé®Â§ßËíúÂè£Âë≥","hours":"08:00 - 18:00","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ Î∂ÅÏ¥åÎ°ú4Í∏∏ 20","lat":37.5792526,"lon":126.9859384,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"Á•û‰ªôÈõ™ÊøÉÊπØ (Sinseon)","kr_name":"Ïã†ÏÑ†ÏÑ§ÎÜçÌÉï Î™ÖÎèôÏ†ê","category":"ÁæéÈ£ü","note":"Âª∫Ë≠∞Âä†ÈπΩÂ∑¥","hours":"24 Â∞èÊôÇÁáüÊ•≠","address":"ÏÑúÏö∏ Ï§ëÍµ¨ Î™ÖÎèôÍ∏∏ 56","lat":37.5647104,"lon":126.9867180,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"ÁÑ°Âû¢Â±ã (Muguok)","kr_name":"Î¨¥Íµ¨Ïò•","category":"ÁæéÈ£ü","note":"12:00 ÈñãÊîæË®Ç‰Ωç","hours":"11:30 - 21:00","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ Ïú®Í≥°Î°ú1Í∏∏ 7","lat":37.5775630,"lon":126.9813512,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"ÊõπÊõπÂàÄÂâäÈ∫µ (Jojo Kalguksu)","kr_name":"Ï°∞Ï°∞ÏπºÍµ≠Ïàò ÏãúÏ≤≠Ï†ê","category":"ÁæéÈ£ü","note":"","hours":"10:00 - 21:30","address":"ÏÑúÏö∏ Ï§ëÍµ¨ ÏÑ∏Ï¢ÖÎåÄÎ°ú11Í∏∏ 27","lat":37.5620078,"lon":126.9754246,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"Â∞èË±¨Â≠òÈå¢Á≠í (Piggy Bank)","kr_name":"ÎèºÏßÄÏ†ÄÍ∏àÌÜµ","category":"ÁæéÈ£ü","note":"ÂºòÂ§ßÁ´ô 8 ËôüÂá∫Âè£","hours":"14:00 - 02:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ Ïñ¥Ïö∏ÎßàÎãπÎ°ú 146-1","lat":37.5562643,"lon":126.9262793,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"Ê†°ÊùëÁ≠ÜÊàø (Kyochon Pilbang)","kr_name":"ÍµêÏ¥åÌïÑÎ∞©","category":"ÁæéÈ£ü","note":"ÈÄ±‰∏ÄÂÖ¨‰ºë","hours":"16:00 - 23:30","address":"ÏÑúÏö∏ Ïö©ÏÇ∞Íµ¨ Î≥¥Í¥ëÎ°ú 127","lat":37.5256549,"lon":127.0014189,"zone":"Êº¢Âçó/Ê¢®Ê≥∞Èô¢"},
            {"cn_name":"JO & DAWSON","kr_name":"Ï°∞Ïï§ÎèÑÏä®","category":"ÂíñÂï°ÁîúÈªû","note":"ÁÑ¶Á≥ñÂ∏É‰∏ÅÂêçÂ∫ó","hours":"12:00 - 21:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÎèôÍµêÎ°ú41Í∏∏ 31","lat":37.5636894,"lon":126.9228307,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"ËøéÊúà (Dalmaji)","kr_name":"Îã¨ÎßàÏßÄ ÏùÑÏßÄÎ°úÏ†ê","category":"ÁæéÈ£ü","note":"ÊúÄÂæåÈªûÈ§ê 01:00","hours":"16:00 - 02:00","address":"ÏÑúÏö∏ Ï§ëÍµ¨ ÏùÑÏßÄÎ°ú 112-1","lat":37.5662506,"lon":126.9987609,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"ÈæçÈæçËÄÅÂ∏´ (Yongyong Teacher)","kr_name":"Ïö©Ïö©ÏÑ†ÏÉù ÏÑ±ÏàòÏ†ê","category":"ÁæéÈ£ü","note":"ÊúÄÂæåÈªûÈ§ê 21:00","hours":"16:00 - 22:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏïÑÏ∞®ÏÇ∞Î°ú 116","lat":37.5440368,"lon":127.0565971,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"Èêò‰∏âËÇâ (Jongsamyook)","kr_name":"Ï¢ÖÏÇºÏú°","category":"ÁæéÈ£ü","note":"ÈêòË∑Ø‰∏âË°óÁ´ô","hours":"14:00 - 23:30","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ ÎèàÌôîÎ¨∏Î°ú11Í∏∏ 8-1","lat":37.5725657,"lon":126.9900452,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"Â≠´ÂÆ∂‰∏ÄÈöªÈõû (Son's Chicken)","kr_name":"ÏÜêÍ∞ÄÎÑ§Îã≠ÌïúÎßàÎ¶¨","category":"ÁæéÈ£ü","note":"Èö±ËóèÁâàÂêçÂ∫ó","hours":"11:00 - 22:00","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ Ï¢ÖÎ°ú66Í∞ÄÍ∏∏ 10","lat":37.5735870,"lon":127.0213125,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"Áµ±ÁáüÁîüË†î (Tongyeong Oyster)","kr_name":"ÌÜµÏòÅÍµ¥Ï∞ú","category":"ÁæéÈ£ü","note":"Â≠£ÁØÄÈôêÂÆö","hours":"11:00 - 22:00","address":"ÏÑúÏö∏ ÏòÅÎì±Ìè¨Íµ¨ Ïó¨ÏùòÎèÑÎèô 21-3","lat":37.5267088,"lon":126.9238000,"zone":"Ê±ùÁü£Â≥∂"},
            {"cn_name":"ÁÑ°Âû¢Â±ã ËÅñÊ∞¥Â∫ó (Muguok)","kr_name":"Î¨¥Íµ¨Ïò• ÏÑ±ÏàòÏ†ê","category":"ÁæéÈ£ü","note":"ËÅñÊ∞¥Á´ôÂàÜÂ∫ó","hours":"11:30 - 21:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏïÑÏ∞®ÏÇ∞Î°ú11Í∏∏ 11","lat":37.5447374,"lon":127.0593428,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"Êº¢ÂçóÊ¥ûÈ¶¨Èà¥ËñØÊéíÈ™®ÊπØ","kr_name":"ÌïúÎÇ®ÎèôÍ∞êÏûêÌÉï","category":"ÁæéÈ£ü","note":"ÂøÖÂêÉËÄÅÂ∫ó","hours":"24 Â∞èÊôÇÁáüÊ•≠","address":"ÏÑúÏö∏ Ïö©ÏÇ∞Íµ¨ Ïö∞ÏÇ¨Îã®Î°ú 43","lat":37.5308068,"lon":126.9967969,"zone":"Êº¢Âçó/Ê¢®Ê≥∞Èô¢"},
            {"cn_name":"Parole & Langue","kr_name":"ÌååÎ°§Ïï§ÎûëÍ∑∏","category":"ÂíñÂï°ÁîúÈªû","note":"Â°îÈ°ûÁîúÈªûÁÜ±ÈñÄÂ∫ó","hours":"13:00 - 21:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏÑ±ÎØ∏ÏÇ∞Î°ú29ÏïàÍ∏∏ 8","lat":37.5651538,"lon":126.9229985,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"Butty Sandwich","kr_name":"Î≤ÑÌã∞ÏÉåÎìúÏúÑÏπò","category":"ÂíñÂï°ÁîúÈªû","note":"Â∑ßÂ∑¥ÈÅî‰∏âÊòéÊ≤ª","hours":"11:00 - 19:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÎßùÏõêÎèô 473-9","lat":37.5558600,"lon":126.9008700,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"È¶¨Â±±Â§ßÂ™ΩÂÆâÂ∫∑È≠öËí∏","kr_name":"ÎßàÏÇ∞Ìï†Îß§ÏïÑÍµ¨Ï∞ú","category":"ÁæéÈ£ü","note":"Âú®Âú∞Âè£Á¢ëÂ∫ó","hours":"11:00 - 22:00","address":"ÏÑúÏö∏ Ïö©ÏÇ∞Íµ¨ ÌõÑÏïîÎèô 44-8","lat":37.5501100,"lon":126.9802800,"zone":"Êº¢Âçó/Ê¢®Ê≥∞Èô¢"},
            {"cn_name":"hetras ËÅñÊ∞¥","kr_name":"Ìó§Ìä∏ÎùºÏä§ ÏÑ±Ïàò","category":"Ë≥ºÁâ©","note":"Êé®Ëñ¶ No.29, No.7, No.5","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ Ïó∞Î¨¥Ïû•Í∏∏ 89","lat":37.5411759,"lon":127.0595267,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"newmix coffee","kr_name":"Îâ¥ÎØπÏä§Ïª§Ìîº","category":"ÂíñÂï°ÁîúÈªû","note":"ÂøÖË≤∑Âç≥Ê∫∂ÂíñÂï°‰º¥ÊâãÁ¶Æ","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ Ïó∞Î¨¥Ïû•Í∏∏ 3","lat":37.5411759,"lon":127.0595267,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"ADERERROR ËÅñÊ∞¥","kr_name":"ÏïÑÎçî ÏÑ±Ïàò Ïä§ÌéòÏù¥Ïä§","category":"ÊúçÈ£æ","note":"ÊóóËâ¶Ê¶ÇÂøµÂ∫ó","hours":"13:00 - 21:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÏù¥Î°ú 82","lat":37.5364697,"lon":127.0538762,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"BLUE ELEPHANT ËÅñÊ∞¥","kr_name":"Î∏îÎ£®ÏóòÎ¶¨ÌéÄÌä∏ ÏÑ±Ïàò","category":"ÊúçÈ£æ","note":"Âπ≥ÂÉπÂ¢®Èè°ÂìÅÁâå","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÏù¥Î°ú14Í∏∏ 14","lat":37.5411234,"lon":127.0565635,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"fwee Agit","kr_name":"Ììå ÏïÑÏßÄÌä∏","category":"ÂΩ©Â¶ù","note":"ÂøÖË≤∑Â∏É‰∏ÅÂîáÊ≥•","hours":"11:00 - 21:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ Ïó∞Î¨¥Ïû•Í∏∏ 10","lat":37.5430688,"lon":127.0541356,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"DIOR ËÅñÊ∞¥","kr_name":"ÎîîÏò¨ ÏÑ±Ïàò","category":"ÊôØÈªû","note":"ÁÜ±ÈñÄÂú∞Ê®ôÊãçÁÖß","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ Ïó∞Î¨¥Ïû•5Í∏∏ 7","lat":37.5441865,"lon":127.0528823,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"NYUNYU ËÅñÊ∞¥","kr_name":"Îâ¥Îâ¥ ÏÑ±Ïàò","category":"ÊúçÈ£æ","note":"È£æÂìÅË≥ºÁâ©ËÅñÂú∞","hours":"11:00 - 23:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ Ïó∞Î¨¥Ïû•Í∏∏ 89 2-3F","lat":37.5445,"lon":127.056,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"Thingool Store","kr_name":"ÎùµÍµ¥Ïä§ÌÜ†Ïñ¥ ÏÑ±Ïàò","category":"ÈÅ∏Áâ©","note":"ÁîüÊ¥ªÈÅ∏Áâ©Â∫ó","hours":"11:00 - 21:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÏù¥Î°ú14Í∏∏ 14","lat":37.5411234,"lon":127.0565635,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"KODAK Apparel","kr_name":"ÏΩîÎã•Ïñ¥Ìå®Îü¥ ÎèôÎåÄÎ¨∏","category":"ÊúçÈ£æ","note":"‰ΩçÊñº DunDun 2 Ê®ì","hours":"10:30 - 22:00","address":"ÏÑúÏö∏ Ï§ëÍµ¨ Ïû•Ï∂©Îã®Î°ú 211","lat":37.5693468,"lon":127.0105160,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"ept ËÅñÊ∞¥","kr_name":"Ïù¥ÌîºÌã∞ ÏÑ±Ïàò","category":"ÊúçÈ£æ","note":"ÈüìÂúãÁÜ±ÈñÄÈÅãÂãïÈûã","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ Ïó∞Î¨¥Ïû•Í∏∏ 54","lat":37.5411759,"lon":127.0595267,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"HAUS NOWHERE","kr_name":"ÌïòÏö∞Ïä§ ÎÖ∏Ïõ®Ïñ¥","category":"ÈÅ∏Áâ©","note":"ËáòËÖ∏ÁãóÂú∞Ê®ô/Êñ∞ÂìÅÁâå","hours":"11:00 - 21:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ Í≤ΩÏïÑÍ∏∏ 11","lat":37.541,"lon":127.059,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"thisisneverthat","kr_name":"ÎîîÏä§Ïù¥Ï¶àÎÑ§Î≤ÑÎåì","category":"ÊúçÈ£æ","note":"Ë°óÈ†≠ÊΩÆÊµÅÁ¨¨‰∏ÄÁ´ô","hours":"12:00 - 21:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏûîÎã§Î¶¨Î°ú 32","lat":37.5516170,"lon":126.9197938,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"KITH Seoul","kr_name":"ÌÇ§Ïä§ ÏÑúÏö∏","category":"ÊúçÈ£æ","note":"ÊΩÆÊµÅÂêçÂ∫ó","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ Ïó∞Î¨¥Ïû•Í∏∏ 70","lat":37.5411759,"lon":127.0595267,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"HUMAN MADE","kr_name":"Ìú¥Î®ºÎ©îÏù¥Îìú","category":"ÊúçÈ£æ","note":"ÁÜ±ÈñÄÊΩÆÁâå","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÏù¥Î°ú7Í∏∏ 39","lat":37.5412470,"lon":127.0542669,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"MUSINSA EMPTY","kr_name":"Î¨¥Ïã†ÏÇ¨ Ïó†ÌîÑÌã∞","category":"ÈÅ∏Áâ©","note":"Â§ßÂûãÈÅ∏ÂìÅÂ∫ó","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏÑ±ÏàòÏù¥Î°ú 97","lat":37.5364697,"lon":127.0538762,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"Ê∏ÖÊ∞¥Â†Ç (Cheongsudang)","kr_name":"Ï≤≠ÏàòÎãπ","category":"ÂíñÂï°ÁîúÈªû","note":"ÁõäÂñÑÊ¥ûÁ´πÊûóÈÄ†ÊôØ","hours":"11:30 - 22:00","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ ÎèàÌôîÎ¨∏Î°ú11ÎÇòÍ∏∏ 31-9","lat":37.5736272,"lon":126.9905422,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"YM Coffee House","kr_name":"YMÏª§ÌîºÌïòÏö∞Ïä§","category":"ÂíñÂï°ÁîúÈªû","note":"ÊïôÂ†ÇÈ¢®Ê†ºÂ∞àÊ•≠ÊâãÊ≤ñ","hours":"12:00 - 22:00","address":"ÏÑúÏö∏ ÏùÄÌèâÍµ¨ Ïó∞ÏÑúÎ°ú29Í∏∏ 14-8","lat":37.6201729,"lon":126.9174055,"zone":"È¶ñÁàæÂ∏ÇÂçÄ"},
            {"cn_name":"Cafe Layered","kr_name":"Ïπ¥Ìéò Î†àÏù¥Ïñ¥Îìú Ïó∞ÎÇ®Ï†ê","category":"ÂíñÂï°ÁîúÈªû","note":"Âè∏Â∫∑ÂêçÂ∫ó","hours":"11:00 - 22:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏÑ±ÎØ∏ÏÇ∞Î°ú 161-4","lat":37.5649847,"lon":126.9241878,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"Thanks Oat","kr_name":"Îï°Ïä§Ïò§Ìä∏ Ïó∞ÎÇ®","category":"ÂíñÂï°ÁîúÈªû","note":"Âª∂ÂçóÊ¥ûÊâãÂ∑•ÂÑ™Ê†º","hours":"10:00 - 19:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏÑ±ÎØ∏ÏÇ∞Î°ú23Í∏∏ 68","lat":37.5650202,"lon":126.9206249,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"today's enough","kr_name":"Ïò§ÎäòÎèÑÏ∂©Î∂ÑÌï¥","category":"ÂíñÂï°ÁîúÈªû","note":"ÈÄ±‰∫åÂÖ¨‰ºë","hours":"12:00 - 20:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ Ïó∞Ìù¨Î°ú1Í∏∏ 45","lat":37.5598873,"lon":126.9254959,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"Êò≠Ë≥¢Â†Ç (Sohyeondang)","kr_name":"ÏÜåÌòÑÎãπ","category":"ÂíñÂï°ÁîúÈªû","note":"ÈüìÂ±ãËå∂ÂÆ§","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ ÏÜåÍ≤©Îèô 157-1","lat":37.5796200,"lon":126.9807300,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"Artist Bakery","kr_name":"ÏïÑÌã∞Ïä§Ìä∏ Î≤†Ïù¥Ïª§Î¶¨","category":"ÂíñÂï°ÁîúÈªû","note":"ÈπΩÂèØÈ†åÊéíÈöäÂêçÂ∫ó","hours":"08:00 - 20:00","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ Ïú®Í≥°Î°ú 45","lat":37.5763072,"lon":126.9843495,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"29CM ËÅñÊ∞¥","kr_name":"Ïù¥Íµ¨ÏÑ±Ïàò","category":"ÈÅ∏Áâ©","note":"Á∑ö‰∏äÈÅ∏ÂìÅÂØ¶È´îÂ∫ó","hours":"11:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏïÑÏ∞®ÏÇ∞Î°ú 78","lat":37.5453108,"lon":127.0526786,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"Ground Seesaw","kr_name":"Í∑∏ÎùºÏö¥ÎìúÏãúÏÜå ÏÑúÏ¥å","category":"Â±ïË¶Ω","note":"Ë≥™ÊÑüÂ±ïË¶ΩÁ©∫Èñì","hours":"10:00 - 19:00","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ ÏûêÌïòÎ¨∏Î°ú6Í∏∏ 18-8","lat":37.5781385,"lon":126.9729372,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"Âª£ËóèÂ∏ÇÂ†¥ 156Ëôü","kr_name":"Í¥ëÏû•ÏãúÏû• 156Ìò∏","category":"ÈõúË≤®","note":"Ë≥ºË≤∑ÈüìÂúãË£ΩÊ£âË¢´","hours":"09:00 - 18:00","address":"ÏÑúÏö∏ Ï¢ÖÎ°úÍµ¨ Ï∞ΩÍ≤ΩÍ∂ÅÎ°ú 88","lat":37.5700967,"lon":126.9998283,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"Cociety","kr_name":"ÏΩîÏÇ¨Ïù¥Ïñ¥Ìã∞ ÏÑúÏö∏Ïà≤","category":"Work","note":"ÂâµÊÑèÂ∑•‰ΩúÁ©∫Èñì (ÈÄ±‰∏Ä‰ºë)","hours":"12:00 - 20:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏôïÏã≠Î¶¨Î°ú 82-20","lat":37.5559574,"lon":127.0433184,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"Brautor","kr_name":"Î∏åÎùºÏö∞ÌÑ∞","category":"Work","note":"Ëù¥Ëù∂È§ÖÂêçÂ∫ó/Êï¥Ê£üÂ∫ß‰Ωç","hours":"08:00 - 22:00","address":"ÏÑúÏö∏ ÏÑ±ÎèôÍµ¨ ÏôïÏã≠Î¶¨Î°ú14Í∏∏ 28-3","lat":37.5493171,"lon":127.0450501,"zone":"ËÅñÊ∞¥Ê¥û"},
            {"cn_name":"Debunk","kr_name":"ÎîîÎ≤ôÌÅ¨","category":"Work","note":"Âú∞‰∏ãÂ±§ËÆÄÊõ∏Ê∞õÂúç","hours":"10:00 - 23:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏÑ±ÏßÄ1Í∏∏ 30","lat":37.5480049,"lon":126.9152430,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"Hollys Coffee ÂºòÂ§ß","kr_name":"Ìï†Î¶¨Ïä§ ÌôçÎåÄÏó≠Ï†ê","category":"Work","note":"24Â∞èÊôÇ/ÈÅ©ÂêàÁ≠ÜÈõª","hours":"24 Â∞èÊôÇÁáüÊ•≠","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏñëÌôîÎ°ú 156","lat":37.5560817,"lon":126.9234301,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"Ediya Coffee Lab","kr_name":"Ïù¥ÎîîÏïºÏª§ÌîºÎû©","category":"Work","note":"ÊóóËâ¶Â∫ó/ÂØ¨ÊïûËàíÈÅ©","hours":"07:30 - 02:00","address":"ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ÎÖºÌòÑÎ°ú 636","lat":37.5105088,"lon":127.0326807,"zone":"Ê±üÂçó"},
            {"cn_name":"Terarosa POSCO","kr_name":"ÌÖåÎùºÎ°úÏÇ¨ Ìè¨Ïä§ÏΩîÏÑºÌÑ∞Ï†ê","category":"Work","note":"ÈãºÈêµÊõ∏Êû∂ÁâÜ/Ê±üÂçó","hours":"07:30 - 21:00","address":"ÏÑúÏö∏ Í∞ïÎÇ®Íµ¨ ÌÖåÌó§ÎûÄÎ°ú 440","lat":37.5056932,"lon":127.0558968,"zone":"Ê±üÂçó"},
            {"cn_name":"Mangrove Êù±Â§ßÈñÄ","kr_name":"ÎßπÍ∑∏Î°úÎ∏å ÎèôÎåÄÎ¨∏","category":"‰ΩèÂÆø","note":"üè† ÁÜ±ÈñÄ Co-living","hours":"Check-in 15:00","address":"ÏÑúÏö∏ Ï§ëÍµ¨ Ìá¥Í≥ÑÎ°ú 334","lat":37.5651,"lon":127.0078,"zone":"ÊòéÊ¥û/ÈçæË∑Ø"},
            {"cn_name":"Local Stitch Ë•øÊ©ã","kr_name":"Î°úÏª¨Ïä§Ìã∞Ïπò ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞ ÌÉÄÏö¥ ÏÑúÍµê","category":"‰ΩèÂÆø","note":"üè† ÂºòÂ§ßÂïÜÂúà","hours":"Check-in 15:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏõîÎìúÏªµÎ∂ÅÎ°ú5Í∏∏ 41","lat":37.5562,"lon":126.9167,"zone":"ÂºòÂ§ß/Âª∂Âçó"},
            {"cn_name":"L7 ÂºòÂ§ß","kr_name":"L7 ÌôçÎåÄ","category":"‰ΩèÂÆø","note":"üè® ÂºòÂ§ßÂÖ•Âè£Á´ôÊóÅ","hours":"Check-in 15:00","address":"ÏÑúÏö∏ ÎßàÌè¨Íµ¨ ÏñëÌôîÎ°ú 141","lat":37.5552,"lon":126.9216,"zone":"ÂºòÂ§ß/Âª∂Âçó"}
        ];

        // 2. Render Immediately (No onload/async/await)
        try {
            const listContainer = document.getElementById('list-container');
            const loadingMsg = document.getElementById('loading-msg');
            
            if (listContainer) {
                // Clear loading immediately
                if(loadingMsg) loadingMsg.remove();

                // Generate HTML string first for performance
                let htmlContent = '';
                
                places.forEach(p => {
                    // Safe string handling
                    const cn = p.cn_name || 'Unknown';
                    const kr = p.kr_name || '';
                    const cat = p.category || 'Other';
                    const zone = p.zone || '';
                    const note = p.note || '';
                    const hours = p.hours || '';
                    
                    const query = encodeURIComponent(kr || cn);
                    
                    // Category css class match
                    let catClass = 'cat-' + cat;
                    if(cat === 'Work' || cat === 'Â±ïË¶Ω') catClass = 'cat-Work';
                    
                    htmlContent += `
                    <div class="card" data-cat="${cat}" data-zone="${zone}">
                        <div class="card-header">
                            <div class="card-badges">
                                <span class="badge ${catClass}">${cat}</span>
                                <span class="badge zone">${zone}</span>
                            </div>
                        </div>
                        <div class="place-name-cn">${cn}</div>
                        <div class="place-name-kr">${kr}</div>
                        
                        ${note ? `<div class="info-row">üí° ${note}</div>` : ''}
                        <div class="info-row">üïí ${hours}</div>
                        
                        <div class="actions">
                            <a href="https://www.google.com/maps/search/?api=1&query=${query}" target="_blank" class="action-btn btn-google">Google</a>
                            <a href="https://map.naver.com/p/search/${query}" target="_blank" class="action-btn btn-naver">Naver</a>
                        </div>
                    </div>`;
                });
                
                // Append Footer
                htmlContent += `<div style="text-align:center; margin-top:40px; color:#aaa; font-size:0.8rem;">Made with OpenClaw ‚Ä¢ V8 Safe Mode</div>`;
                
                // Inject HTML
                listContainer.innerHTML = htmlContent;
            } else {
                throw new Error("Container #list-container not found");
            }
        } catch(error) {
            // Fatal Error Handling
            const errMsg = document.getElementById('error-msg');
            if(errMsg) {
                errMsg.style.display = 'block';
                errMsg.innerHTML = "‚ö†Ô∏è Render Error: " + error.message;
            }
            console.error("Critical Render Error:", error);
        }

        // 3. Tab Logic (Simple & Safe)
        function filter(cat) {
            // Update UI
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            // Find button clicked (rough match)
            const btns = document.querySelectorAll('.tab-btn');
            for(let b of btns) {
                if(b.textContent.includes(cat) || (cat==='all' && b.textContent==='ÂÖ®ÈÉ®')) {
                    b.classList.add('active');
                    break;
                }
            }

            // Filter List
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const cCat = card.getAttribute('data-cat') || '';
                let show = false;
                
                if (cat === 'all') show = true;
                else if (cCat.indexOf(cat) > -1) show = true;
                else if (cat === 'Ë≥ºÁâ©' && (cCat === 'ÊúçÈ£æ' || cCat === 'ÈÅ∏Áâ©' || cCat === 'ÂΩ©Â¶ù' || cCat === 'ÈõúË≤®')) show = true;
                
                card.style.display = show ? 'block' : 'none';
            });
            
            // Filter Map (if loaded)
            if(typeof updateMapFilter === 'function') {
                updateMapFilter(cat);
            }
        }
    </script>

    <!-- Map Script (Deferred to End) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Separate scope for Map
        let map = null;
        let markers = [];
        let isMapMode = false;

        function initMap() {
            if(map) return;
            if(typeof L === 'undefined') return; // Not loaded yet
            
            try {
                map = L.map('map').setView([37.5665, 126.9780], 12);
                
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; OpenStreetMap',
                    maxZoom: 20
                }).addTo(map);

                // Add Markers
                places.forEach(p => {
                    if(p.lat && p.lon) {
                        const marker = L.marker([p.lat, p.lon]);
                        const popup = `
                            <div style="text-align:center; min-width:140px;">
                                <div class="popup-title">${p.cn_name}</div>
                                <div style="font-size:0.8rem; color:#666; margin-bottom:5px;">${p.category}</div>
                                <a href="https://map.naver.com/p/search/${encodeURIComponent(p.kr_name)}" target="_blank" class="popup-nav">Naver Â∞éËà™</a>
                            </div>`;
                        marker.bindPopup(popup);
                        markers.push({marker: marker, category: p.category});
                        marker.addTo(map); // Default all visible
                    }
                });
            } catch(e) {
                console.log("Map Error:", e);
            }
        }

        function updateMapFilter(cat) {
            if(!map) return;
            markers.forEach(m => {
                let show = false;
                if (cat === 'all') show = true;
                else if (m.category.indexOf(cat) > -1) show = true;
                else if (cat === 'Ë≥ºÁâ©' && ['ÊúçÈ£æ','ÈÅ∏Áâ©','ÂΩ©Â¶ù','ÈõúË≤®'].includes(m.category)) show = true;

                if(show) m.marker.addTo(map);
                else m.marker.remove();
            });
        }

        function toggleMode() {
            const mapContainer = document.getElementById('map-container');
            const listContainer = document.getElementById('list-container');
            const btn = document.getElementById('map-btn');
            
            isMapMode = !isMapMode;
            
            if (isMapMode) {
                mapContainer.classList.add('visible');
                listContainer.style.display = 'none';
                btn.classList.add('active');
                btn.innerHTML = 'üìã'; 
                
                if(!map) initMap();
                setTimeout(() => { if(map) map.invalidateSize(); }, 100);
            } else {
                mapContainer.classList.remove('visible');
                listContainer.style.display = 'block';
                btn.classList.remove('active');
                btn.innerHTML = 'üó∫Ô∏è';
            }
        }
    </script>
</body>
</html>